let _config={url:[],fps:60,autoPlay:false,homePage:0,onComplate:_onComplate,onLoaded:_onLoaded};const _type=Object.freeze({PLAY:"PLAY",STOP:"STOP",LOOP:"LOOP",YOYOLOOP:"YOYOLOOP",PAUSE:"PAUSE",REVERSE:"REVERSE",PLAYTO:"PLAYTO",YOYOPLAYTO:"YOYOPLAYTO"});let _canvas=document.createElement("canvas"),_ctx=_canvas.getContext("2d"),_currentFrame=0,_totalFrame=0,_stage=new Array,_status="",_then=Date.now(),_interval=1e3/_config.fps,_delta,_loop={start:0,end:0},_playTo=0;function _onLoaded(){console.log("onLoaded")}function _onComplate(){console.log("onComplate_ok")}async function loadImg(url){return new Promise(res=>{let img=new Image;img.onload=(e=>{res(img)});img.src=url})}async function loadImgs(urls){for(let i of urls){let img=await loadImg(i);_stage.push(img)}_config.onLoaded();draw()}function getScaleRatio(obj1,obj2){var ww=obj2.width/obj1.width;var hh=obj2.height/obj1.height;return ww>hh?ww:hh}function tick(){if(_status==_type.PAUSE)return;if(window.requestAnimationFrame){requestAnimationFrame(tick);let now=Date.now();_delta=now-_then;if(_delta>_interval){_then=now-_delta%_interval;draw()}}else{setTimeout(tick,_interval);draw()}}function draw(){if(_stage[_currentFrame]!=undefined){let image=_stage[_currentFrame];let screen_w=_canvas.width;let screen_h=_canvas.height;let ratio=getScaleRatio({width:image.width,height:image.height},{width:screen_w,height:screen_h});let img_h=image.height*ratio;let img_w=image.width*ratio;_ctx.clearRect(0,0,screen_w,screen_h);_ctx.drawImage(image,(screen_w-img_w)*.5,(screen_h-img_h)*.5,img_w,img_h)}setStatus()}function setStatus(){if(_status==_type.PLAY){_currentFrame++;if(_config.autoPlay){if(_currentFrame>_totalFrame){_currentFrame=0}}else{if(_currentFrame>_totalFrame){_status=_type.PAUSE;_onComplate()}}}else if(_status==_type.REVERSE){_currentFrame--;if(_config.autoPlay){if(_currentFrame<0){_currentFrame=_totalFrame}}else{if(_currentFrame<0){_status=_type.PAUSE;_onComplate()}}}else if(_status==_type.LOOP){_currentFrame++;if(_currentFrame<_loop.start){_currentFrame=_loop.start}if(_currentFrame>_loop.end){_currentFrame=_loop.start}}else if(_status==_type.YOYOLOOP){_currentFrame--;if(_currentFrame<_loop.start){_currentFrame=_loop.end}if(_currentFrame>_loop.end){_currentFrame=_loop.end}}else if(_status==_type.PLAYTO){_currentFrame++;if(_currentFrame>_playTo){_status=_type.PAUSE;_onComplate()}}else if(_status==_type.YOYOPLAYTO){_currentFrame--;if(_currentFrame<_playTo){_status=_type.PAUSE;_onComplate()}}}class sequenceFrames{constructor(id,url,w=100,h=100,opts={}){_config=Object.assign(_config,opts);_interval=1e3/_config.fps;_currentFrame=_config.homePage;let cont=document.querySelector("#"+id);_canvas.width=w;_canvas.height=h;cont.appendChild(_canvas);_config._url=url;_totalFrame=url.length;loadImgs(url)}stop(){_status=_type.PAUSE;_currentFrame=0}pause(){_status=_type.PAUSE}play(){_status=_type.PLAY;tick()}nextFrame(){if(_currentFrame<_totalFrame){_currentFrame++}else{_currentFrame=0}draw()}prevFrame(){if(_currentFrame>0){_currentFrame--}else{_currentFrame=_totalFrame}draw()}reverse(){_currentFrame=_totalFrame;_status=_type.REVERSE;tick()}gotoAndPlay(n){_currentFrame=n;this.play()}gotoAndStop(n){_currentFrame=n;draw()}currentFrame(){return _currentFrame}loop(start,end,yoyo=false){if(yoyo){_status=_type.YOYOLOOP}else{_status=_type.LOOP}if(start<0)start=0;if(start>_totalFrame)start=_totalFrame;_loop.start=start;_loop.end=end;tick()}playTo(n){_playTo=n;if(_currentFrame<n){_status=_type.PLAYTO}else{_status=_type.YOYOPLAYTO}tick()}}export default sequenceFrames;